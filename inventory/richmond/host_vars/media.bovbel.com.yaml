---
ansible_user: pbovbel
ansible_become_pass: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  65383961633262653965396137356130343761346562336336326432323666383465393765663662
  3536653038643831643736343734646337626430653464650a626661343665613364653938393661
  36633737666564303639396431323338616132616235396135356434643964393761656236643666
  3430316536656539660a383266653164383531393838653433313566613133363533306463366134
  3933
ansible_email: paul@bovbel.com

admin_users:
  - paul@bovbel.com

share_users:
  - andrew@bovbel.com
  - deasonst@gmail.com
  - eugene.tkach@gmail.com
  - gamask@gmail.com
  - igorlitvinov@gmail.com
  - kyle.coventry@gmail.com
  - rebecca@bovbel.com
  - rustedghost@gmail.com
  - ryan.audet@gmail.com
  - sean.vedell@gmail.com
  - victorvorobiev@gmail.com
  - woodward.adam.m@gmail.com

web_user: pbovbel
web_password: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  37636239323865633539653364323932306132363933343365346532363566366464363963383863
  3939356464393138363532336565626261643262656466630a383938626531623138323136613461
  30646464393363613932393933303262626264313063356464656232353864643430323734373630
  3061656461643865640a643762626633646130666264373137386161653663303331646332343164
  3931

# Route53 DDNS configuration
aws_ddns_hosted_zone: ZJMZZCLW5S6T9
aws_access_key_id: AKIA2MCQ5AI3ATQ5HA75
aws_secret_access_key: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  63373362643230396364306438653862303664393361313861316265366661636438376430346637
  3866336430396264653464303035656561346161313935650a333661383438666437363133336362
  65316464363361323935626237393336363461353736303130653231663261343464356265623135
  6565366466353064610a356435303432366532616236616331623332633461353535343864386230
  30396232333537613339386131323238323066316533643137656331383036396631623063386665
  3261356137353061343863346638326539643938323762323763

# Useful paths
data_folder: /mnt/storage
app_folder: "{{ data_folder }}/app"
media_folder: "{{ data_folder }}/media"
backup_folder: "{{ data_folder }}/backup"
download_folder: "{{ media_folder }}/downloads"
share_folder: "{{ media_folder }}"
movies_folder: "{{ media_folder }}/movies"
tv_folder: "{{ media_folder }}/tv"

pia_username: p4418147
pia_password: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  36383736346664363437303738626166643838353336633434386135366561383966366130653432
  3837336163316635386437626434383531666262303538660a626263313439393263653437373335
  66386534363233316338306539386666303037623931316638346563313331376366613664643065
  6638343761396139370a623834653464666665326162333936306535646333666261343736346464
  6262

zfs_pool: storage

docker_compose:
  services:
    ddns:
      container_name: ddns
      image: sjmayotte/route53-dynamic-dns:latest
      networks:
        - apps
      environment:
        - "AWS_ACCESS_KEY_ID={{ aws_access_key_id }}"
        - "AWS_SECRET_ACCESS_KEY={{ aws_secret_access_key }}"
        - "AWS_REGION=us-east-1"
        - "ROUTE53_HOSTED_ZONE_ID={{ aws_ddns_hosted_zone }}"
        - "ROUTE53_DOMAIN={{ inventory_hostname }}"
        - "ROUTE53_TYPE=A"
        - "ROUTE53_TTL=300"
        - "UPDATE_FREQUENCY=60000"
        - "SEND_EMAIL_SES=true"
        - "SES_FROM_ADDRESS={{ ansible_email }}"
        - "SES_TO_ADDRESS={{ ansible_email }}"
    plex:
      volumes:
        - "{{ app_folder }}/plex:/config"
        - "{{ media_folder }}:/mnt/storage/share:ro"
    transmission:
      image: haugene/transmission-openvpn:latest
      cap_add:
        - NET_ADMIN
      networks:
        - apps
      # dns:
      #   - 8.8.8.8
      #   - 1.1.1.1
      volumes:
        - "{{ app_folder }}/transmission/config:/config"
        - "{{ app_folder }}/transmission/home:/data/transmission-home"
        - "{{ download_folder }}:/downloads"
      environment:
        - "PUID={{ uid }}"
        - "PGID={{ gid }}"
        - "TZ=America/Toronto"
        - "WEBPROXY_ENABLED=false"
        - "LOCAL_NETWORK=172.25.0.0/16"
        - "OPENVPN_PROVIDER=PIA"
        - "OPENVPN_CONFIG=CA\ Toronto"
        - "OPENVPN_USERNAME={{ pia_username }}"
        - "OPENVPN_PASSWORD={{ pia_password }}"
        - "CREATE_TUN_DEVICE=true"
        - "TRANSMISSION_INCOMPLETE_DIR_ENABLED=false"
        - "TRANSMISSION_WATCH_DIR=/downloads/watch"
        - "TRANSMISSION_DOWNLOAD_DIR=/downloads"
        - "TRANSMISSION_SCRIPT_TORRENT_DONE_ENABLED=true"
        - "TRANSMISSION_SCRIPT_TORRENT_DONE_FILENAME=/config/unpack.sh"
    jellyfin:
      image: linuxserver/jellyfin
      container_name: jellyfin
      networks:
        - apps
      ports:
        - 8096:8096
      environment:
        - "PLEX_UID={{ uid }}"
        - "PLEX_GID={{ gid }}"
        - "TZ=America/Toronto"
      volumes:
        - "{{ app_folder }}/jellyfin:/config"
        - "{{ media_folder }}:/data:ro"
      restart: "no"

caddy:
  endpoints:
    jellyfin:
      type: proxy
      auth: null
      path: /jellyfin
      host: jellyfin
      port: 8096
      users: "{{ admin_users }}"
