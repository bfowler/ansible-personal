kernel_options:
  # disable all mitigations (only works in 5.2+ kernel)
  - mitigations=off
  # disable Spectre and Meltdown mitigation (https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/SpectreAndMeltdown)
  - nopti noibrs noibpb nospectre_v2 spec_store_bypass_disable=off
  # disable L1TF mitigations (https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/L1TF)
  - l1tf=off
  # disable MDS mitigations (https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/MDS)
  - mds=off

ansible_user: pbovbel
ansible_email: paul@bovbel.com

admin_users:
  - paul@bovbel.com

share_users:
  - andrew@bovbel.com
  - deasonst@gmail.com
  - eugene.tkach@gmail.com
  - gamask@gmail.com
  - igorlitvinov@gmail.com
  - kyle.coventry@gmail.com
  - rebecca@bovbel.com
  - rustedghost@gmail.com
  - ryan.audet@gmail.com
  - victorvorobiev@gmail.com
  - woodward.adam.m@gmail.com


# Route53 DDNS configuration
aws_ddns_hosted_zone: ZJMZZCLW5S6T9
aws_access_key_id: AKIA2MCQ5AI3ATQ5HA75
aws_secret_access_key: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  63373362643230396364306438653862303664393361313861316265366661636438376430346637
  3866336430396264653464303035656561346161313935650a333661383438666437363133336362
  65316464363361323935626237393336363461353736303130653231663261343464356265623135
  6565366466353064610a356435303432366532616236616331623332633461353535343864386230
  30396232333537613339386131323238323066316533643137656331383036396631623063386665
  3261356137353061343863346638326539643938323762323763

# Basic auth configuration
web_user: pbovbel
web_password: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  37636239323865633539653364323932306132363933343365346532363566366464363963383863
  3939356464393138363532336565626261643262656466630a383938626531623138323136613461
  30646464393363613932393933303262626264313063356464656232353864643430323734373630
  3061656461643865640a643762626633646130666264373137386161653663303331646332343164
  3931

gmail_access_key: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  32653332643230363831396636393963636661303435396637663237313131303032613362336465
  3662653665643331623262323638653530343539306662610a303639356165376339623866653465
  32383764653934316133303032353639633439336334363136633439623638356166666339633961
  3339343933393930370a366435386331393564383632643661653134656636323764366265333535
  65623566613737636639373439323564356138366535636433313932313865313033

google_oauth2_client_id: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  34313439346337363631633633393936633763313638623034656238306333616531626238616130
  3061353332343331343134613134353332613237643862360a303761663162393230623637353433
  63396430363263313264333434623237313163636634333462626137626631643466626637313730
  6262653731353337630a323736626235396662393862653362336631353738376462656138363264
  38383264656430343635346466643335623239333262303166386562303363613761333463616338
  39383865626135343662336332656233323932396136366233663339323566356339393565633034
  30346130653339613636653666643131333162643935643565386531653465656137343061636535
  64323430663763323135623765363164333836383161366535363431376433666365666432373264
  65666431383939303832326162376333333634666135303638336636653038366264

google_oauth2_client_secret: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  65643238623433323062633863393135656363373638386331323238386438356664626264346138
  3233663761383337616566636231303863326465663662310a316261623864336436393438363463
  61346630303966363666666230646139663663333737626563346338663662613830386566336133
  3736366133653038370a306161666364373237346638663963646539313632326465353037313665
  33386339613734616564383837666166343937356565633236343564643962323166

docker_compose:
  version: '3.5'
  networks:
    apps:
      name: apps
  services:
    smtp:
      container_name: smtp
      image: namshi/smtp
      networks:
        - apps
      environment:
        - "RELAY_NETWORKS=:10.0.0.0/8:172.16.0.0/12:192.168.0.0/16"
        - "GMAIL_USER={{ ansible_email }}"
        - "GMAIL_PASSWORD={{ gmail_access_key }}"
    caddy:
      build:
        args:
          plugins: login,jwt
        context: github.com/abiosoft/caddy-docker.git
      container_name: caddy
      networks:
        - apps
      ports:
        - 80:80
        - 443:443
      restart: unless-stopped
      volumes:
        - /etc/docker/Caddyfile:/etc/Caddyfile:ro
        - "{{ app_folder }}/caddy:/root/.caddy"
        - "{{ share_folder }}:/srv/share:ro"
        - "{{ app_folder }}/caddy/log:/log"
    watchtower:
      image: containrrr/watchtower
      container_name: watchtower
      networks:
        - apps
      volumes:
        - /var/run/docker.sock:/var/run/docker.sock
      restart: unless-stopped
    resilio:
      image: linuxserver/resilio-sync
      container_name: resilio
      networks:
        - apps
      ports:
        - 55555:55555
        - 55555:55555/udp
      volumes:
        - "{{ app_folder }}/resilio:/config"
        - "{{ data_folder }}:/sync"
      restart: unless-stopped
      environment:
        - "PUID={{ uid }}"
        - "PGID={{ gid }}"
        - "TZ=America/Toronto"

caddy:
  redirect: /dashboard
  endpoints:
    dashboard:
      type: proxy
      auth: oauth
      path: /dashboard
      host: "{{ ansible_default_ipv4.address }}"
      port: 9090
      users: "{{ admin_users }}"
    share:
      type: share
      auth: oauth
      path: /share
      users: "{{ admin_users + share_users }}"
    resilio:
      type: proxy
      auth: oauth
      path: /gui
      host: resilio
      port: 8888
      users: "{{ admin_users }}"

  remotes: {}
